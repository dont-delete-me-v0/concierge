# Database Package

## Содержание

- `init/` - SQL скрипты инициализации базы данных
- `backups/` - Директория для резервных копий (не в Git)
- Скрипты резервного копирования

## Инициализация базы данных

SQL скрипты из папки `init/` автоматически выполняются при первом запуске PostgreSQL контейнера.

## Резервное копирование

### Быстрый старт

```bash
# Запустить автоматические бэкапы
docker-compose up -d db-backup

# Создать ручной бэкап
make backup

# Посмотреть список бэкапов
make list-backups

# Восстановить из бэкапа
make restore FILE=packages/database/backups/backup_20241014_100000.sql.gz
```

### Полная документация

См. [BACKUP_GUIDE.md](./BACKUP_GUIDE.md) для подробной документации по:

- Конфигурации автоматических бэкапов
- Расписанию и ротации
- Восстановлению данных
- Устранению проблем
- Best practices для продакшена

## Скрипты

| Скрипт             | Описание                                    |
| ------------------ | ------------------------------------------- |
| `backup.sh`        | Создание бэкапа с прямым подключением к БД  |
| `docker-backup.sh` | Создание бэкапа через Docker контейнер      |
| `restore.sh`       | Восстановление из бэкапа                    |
| `backup-cron.sh`   | Сервис автоматических бэкапов по расписанию |

## Переменные окружения

```bash
# Расписание автоматических бэкапов (cron формат)
BACKUP_SCHEDULE=0 2 * * *

# Срок хранения бэкапов в днях
BACKUP_RETENTION_DAYS=30
```

См. `env.example` в корне проекта для полного списка переменных.
